<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plonesurvey">

<body>
<metal:main fill-slot="main">

  <div metal:use-macro="here/document_actions/macros/document_actions" />

  <tal:def define="users context/getAuthenticatedRespondents;
                   standard_module modules/Products/PythonScripts/standard">
    <label>Authenticated Respondents:</label><br/>
    
    <tal:if condition="not:users">
      <i>No respondents found</i>
      <br/>
    </tal:if>
    
    <tal:if condition="users">
      <table class="listing">
        <tr>
          <th>Respondent</th>
          <th>Key</th>
          <th>Action</th>
        </tr>
        <tr tal:repeat="user users"
            tal:attributes="class python:(repeat['user'].index % 2 == 0) and 'odd' or 'even'">
          <td tal:content="string:${user/fullname} (${user/id})"></td>
          <td tal:content="user/key"></td>

          <td tal:define="encoded_email python:standard_module.url_quote(user['id'])">
            <ul>
            
              <li>
                <a tal:attributes="href string:${here/absolute_url}/survey_send_invite?email=${encoded_email}">
                  Send Invite
                </a>
              </li>

              <li>
                <a tal:attributes="href string:${here/absolute_url}/deleteAuthenticatedRespondent?email=${encoded_email}"
                   onClick="return window.confirm('Are you sure?');">Delete Respondent</a>
              </li>
              
            </ul>
          </td>
        </tr>
      </table>

      <a tal:attributes="href string:${here/absolute_url}/survey_send_invite?email=all">Click</a> 
      to send survey invite to all respondents.
    </tal:if>
    
  </tal:def>
  
  <form name="add_authenticated_respondent"
              method="post"
              tal:attributes="action template/id"
              tal:define="errors options/state/getErrors;">
              
    <input type="hidden" name="form.submitted" value="1" />
    <fieldset>    
      <legend i18n:translate="new_authenticated_respondent">New Authenticated Respondent</legend>

      <div class="field"
           tal:define="error errors/fullname|nothing;
                       fullname request/fullname | nothing;"
           tal:attributes="class python:test(error, 'field error', 'field')">

        <label for="fullname"
               i18n:translate="label_fullname">Name</label>

        <span class="fieldRequired" title="Required"
              i18n:attributes="title title_required;"
              i18n:translate="label_required">(Required)</span>
      
        <div tal:content="error">Validation error output</div>

        <input type="text"
               name="fullname"
               id="fullname"
               size="30"
               value="fullname"
               tabindex=""
               tal:attributes="value fullname;
                               tabindex tabindex/next;"/>
      </div>

      <div class="field"
           tal:define="error errors/emailaddress|nothing;
                       emailaddress request/emailaddress | nothing;"
           tal:attributes="class python:test(error, 'field error', 'field')">

        <label for="emailaddress"
               i18n:translate="label_email_address">Email Address</label>

        <span class="fieldRequired" title="Required"
              i18n:attributes="title title_required;"
              i18n:translate="label_required">(Required)</span>
      
        <div tal:content="error">Validation error output</div>

        <input type="text"
               name="emailaddress"
               id="emailaddress"
               size="30"
               value="emailaddress"
               tabindex=""
               tal:attributes="value emailaddress;
                               tabindex tabindex/next;"/>
      </div>

<!--
      <div class="field"
           tal:define="error errors/password|nothing;
                       password request/password | nothing;"
           tal:attributes="class python:test(error, 'field error', 'field')">

        <label for="password"
               i18n:translate="label_password">Password</label>

        <span class="fieldRequired" title="Required"
              i18n:attributes="title title_required;"
              i18n:translate="label_required">(Required)</span>
      
        <div tal:content="error">Validation error output</div>

        <input type="text"
               name="password"
               id="password"
               size="30"
               value="password"
               tabindex=""
               tal:attributes="value password;
                               tabindex tabindex/next;"/>
      </div>
-->
      <div class="formControls">
        <input class="context"
               type="submit"
               value="Create Respondent"
               name="submit"
               tal:attributes="tabindex tabindex/next"
                               i18n:attributes="value create_respondent_button" />
      </div>
    </fieldset>
  </form>
</metal:main>

</body>
</html>
